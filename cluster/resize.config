IMAGE_ID=ami-5c730034
INSTANCE_TYPE=m3.large
KEY_NAME=ImpalaToGo
PRIVATE_KEY=ImpalaToGo.pem
SECURITY_GROUP=impala2go-slave
LOG_DIR=/var/log/impalatogo
IMPALA_TO_GO_CACHE=/var/cache/impala2go
CLUSTER_VAR_BASE=${IMPALA_TO_GO_CACHE}/cluster
CLUSTER_VAR_DIR=${CLUSTER_VAR_BASE}/${BATCH_ID}
KNOWN_CLUSTERS_DIR=${IMPALA_TO_GO_CACHE}/clusters
TEMP_FILE=/tmp/${BATCH_ID}

LOCK_DIR=/var/lock/imala2go/
LOCK_FILE=${LOCK_DIR}/${BATCH_ID}.lock

#configuration for SSH connectoin to cluster nodes
SSH_KNOWN_HOSTS_FILE=$CLUSTER_VAR_DIR/known_hosts
SSH_PARAMS="-t -o UserKnownHostsFile=$SSH_KNOWN_HOSTS_FILE -i $PRIVATE_KEY"

#DRY_RUN=--dry-run
#for example: AWS_PROFILE_PARAM=--profile=cluster
AWS_PROFILE_PARAM=""
AWS_CMD="aws $AWS_PROFILE_PARAM ec2 $DRY_RUN"

function store_cluster_id(){
	local cluster_id=$1
	touch ${KNOWN_CLUSTERS_DIR}/${cluster_id}
	mkdir -p ${CLUSTER_VAR_DIR}
}

function wait_lock(){
	while [ -f $LOCK_FILE ]; 
	do 
		sleep 1
	done
}

function take_lock(){
	wait_lock
	touch $LOCK_FILE
}

function release_lock(){
	rm -f $LOCK_FILE
}
